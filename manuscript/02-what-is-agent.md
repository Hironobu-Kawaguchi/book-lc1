# エージェントとは何か：定義とユースケース

## エージェントの定義

エージェント型アプリケーションは外部ツールを利用しながら目標達成を図るLLM中心のソフトウェアです。
従来のチャットボットやQ&Aシステムとの違いは、複数のステップを自律的に実行できる点にあります。
ユーザーの質問を受け取った後、必要に応じて検索エンジンを呼び出したり、データベースにクエリを発行したり、計算を行ったりします。
これらの中間結果を統合して、最終的な回答を生成します。

エージェントの核となるのは LLM の推論能力です。
LLM は与えられた目標に対して、どのツールをどの順序で使うべきかを判断します。
ツールの実行結果を観察し、次に何をすべきかを再評価します。
このサイクルを繰り返すことで、複雑なタスクを段階的に解決します。

## エージェントの主要な特徴

エージェントはツール呼び出しと状態管理とヒューマンインザループを特徴とします。

### ツール呼び出し（Tool Calling）

ツール呼び出しは、エージェントが外部機能にアクセスする仕組みです。
ツールとは、検索API、データベースクエリ、計算関数、外部サービスの API など、Python 関数として定義されたあらゆる処理を指します。
LLM はツールの説明（関数名、引数、用途）を読み取り、必要に応じてツールを呼び出す判断を下します。

OpenAI の Function Calling や Anthropic の Tool Use がこの機能を提供します。
LangChain と LangGraph では、これらの API を抽象化し、統一的なインターフェースでツールを定義できます。

### 状態管理（State Management）

状態管理は、エージェントが会話の文脈や中間結果を保持する仕組みです。
単発の質問応答では不要ですが、複数ステップのタスクでは状態が必須になります。
例えば、「先週の売上データを取得して、前週と比較してグラフを作成してください」という指示では、売上データの取得結果をメモリに保持し、次のステップで利用します。

LangGraph では、状態をグラフのノード間で受け渡すことで、複雑なワークフローを表現できます。
状態はチェックポイントとして永続化することも可能で、長時間実行やヒューマンインザループに対応します。

### ヒューマンインザループ（Human-in-the-Loop）

ヒューマンインザループは、エージェントが判断に迷った際に人間の承認を求める仕組みです。
完全自動化が難しいタスクや、リスクの高い操作（データ削除、外部送金など）では、人間の確認が必要です。
エージェントは一時停止し、ユーザーに選択肢を提示して、承認を待ちます。

LangGraph のチェックポイント機能を使うと、エージェントの実行を中断して、後から再開できます。
これにより、非同期的な承認フローを実装できます。

## RAG との関係

RAGはエージェントに知識を供給し検索と生成と意思決定を結び付けます。
RAG（Retrieval-Augmented Generation）は、外部知識ベースから関連情報を検索し、それを LLM に与えて回答を生成する手法です。
エージェントにとって RAG は重要なツールの一つです。

例えば、社内文書を検索するツールを定義すると、エージェントは質問内容に応じて検索を実行し、取得した文書を参照して回答を生成します。
RAG は単なる検索ではなく、検索結果の評価やフィルタリング、複数ソースの統合といった高度な処理を含みます。
エージェントは RAG を活用することで、知識の鮮度と正確性を保ちながら、複雑な質問に答えられます。

## 業界別ユースケース

業界ユースケースにはカスタマー対応と自動レポーティングと営業支援が含まれます。

### カスタマーサポート

カスタマーサポートでは、顧客の問い合わせに対して、FAQ 検索や注文履歴の照会、返品手続きの案内などを自動化できます。
エージェントは顧客の質問を理解し、必要な情報を検索し、適切な回答を生成します。
複雑な問い合わせは人間のオペレーターにエスカレーションします。

### 自動レポーティング

ビジネスインテリジェンス分野では、データベースから売上やユーザー行動のデータを取得し、グラフやサマリーを自動生成するエージェントが活用されます。
経営者が「今月の売上トップ5の商品を教えて」と質問すると、エージェントは SQL クエリを発行し、結果を整形して報告します。

### 営業支援

営業支援では、顧客情報の検索、提案書のドラフト作成、商談履歴の整理などをエージェントが支援します。
営業担当者は顧客名を伝えるだけで、過去の商談履歴や購入実績を自動的に取得し、次のアクションを提案してもらえます。

### その他の分野

医療分野では、患者の症状から関連する論文を検索し、診断支援を行うエージェント。
法務分野では、契約書のレビューや判例検索を行うエージェント。
教育分野では、学習者の理解度に応じて問題を出題し、解説を生成するエージェント。

## 最小実装：ツール呼び出しを体験する

実装ショート体験ではユーザ質問からツール呼び出しを行う最小プロンプトとコードを示します。
ここでは、天気情報を返すシンプルなツールを定義し、LLM がそれを呼び出す様子を確認します。

```python
from langchain_openai import ChatOpenAI
from langchain_core.tools import tool

@tool
def get_weather(location: str) -> str:
    """指定された地域の天気情報を取得します。"""
    # 実際にはAPIを呼び出すが、ここでは固定値を返す
    return f"{location}の天気は晴れです。"

llm = ChatOpenAI(model="gpt-4o", temperature=0)
llm_with_tools = llm.bind_tools([get_weather])

response = llm_with_tools.invoke("東京の天気を教えて")
print(response)
```

このコードでは、`get_weather` という関数を `@tool` デコレータで装飾しています。
LLM は「東京の天気を教えて」という質問を受け取ると、`get_weather` ツールを呼び出すべきだと判断します。
実際のツール実行とその結果の処理は次章以降で詳しく扱います。

## 本章のまとめ

本章では、エージェントとは何か、その主要な特徴、RAG との関係、業界別ユースケースを説明しました。
エージェントは LLM を中心に、ツール呼び出し、状態管理、ヒューマンインザループを統合したソフトウェアです。
次章では、LangChain と LangGraph のエコシステムがどのように進化してきたかを俯瞰します。

